<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Okinawa Trip 2026</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Noto Sans JP', sans-serif; 
            background-image: url('https://images.unsplash.com/photo-1542051841857-5f90071e7989?q=80&w=2070&auto=format&fit=crop'); 
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            -webkit-tap-highlight-color: transparent; 
        }
        .main-overlay {
            background: rgba(248, 250, 250, 0.9);
            backdrop-filter: blur(8px);
            min-height: 100vh;
        }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.3); }
        .active-day { background-color: #5FA8A3 !important; color: white !important; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        input, textarea { background: transparent; border: none; outline: none; width: 100%; }
        textarea { resize: none; }
    </style>
</head>
<body class="text-slate-700">
    <div id="app" class="main-overlay pb-28">
        
        <header class="p-6 pt-10">
            <div class="flex justify-between items-start">
                <div>
                    <h1 class="text-2xl font-bold text-slate-800">沖縄旅行 2026</h1>
                    <p class="text-slate-500 text-sm">2026/1/4 - 1/8</p>
                </div>
                <div v-if="weather" class="bg-white/50 px-3 py-1 rounded-full text-xs font-medium border border-white">
                    {{ weather.temp }}°C · {{ weather.desc }}
                </div>
            </div>
        </header>

        <div v-if="activeTab === 'itinerary'" class="flex overflow-x-auto px-6 space-x-3 hide-scrollbar mb-6">
            <button v-for="(info, index) in dateInfo" :key="index" 
                @click="currentDay = index + 1"
                :class="['flex-shrink-0 px-4 py-3 rounded-2xl flex flex-col items-center min-w-[100px] transition-all duration-300 shadow-sm', 
                currentDay === index + 1 ? 'active-day shadow-teal-100 scale-105' : 'bg-white text-slate-400']">
                <span class="text-[10px] uppercase font-bold opacity-80">{{ info.date }} ({{ info.week }})</span>
                <span class="text-lg font-bold">Day {{ index + 1 }}</span>
            </button>
        </div>

        <main class="px-6">
            <div class="flex bg-slate-200/50 rounded-xl p-1 mb-6">
                <button @click="activeTab = 'itinerary'" :class="['flex-1 py-2 rounded-lg text-[13px] font-bold transition-all', activeTab === 'itinerary' ? 'bg-white shadow text-teal-600' : 'text-slate-500']">行程</button>
                <button @click="activeTab = 'split'" :class="['flex-1 py-2 rounded-lg text-[13px] font-bold transition-all', activeTab === 'split' ? 'bg-white shadow text-teal-600' : 'text-slate-500']">記帳</button>
                <button @click="activeTab = 'phrases'" :class="['flex-1 py-2 rounded-lg text-[13px] font-bold transition-all', activeTab === 'phrases' ? 'bg-white shadow text-teal-600' : 'text-slate-500']">對話</button>
            </div>

            <div v-if="activeTab === 'itinerary'" class="space-y-4">
                <div v-for="(item, index) in itinerary[currentDay]" :key="index" class="glass-card p-5 rounded-3xl shadow-sm border border-white/50 relative group">
                    <div class="flex justify-between items-start mb-2">
                        <input v-model="item.time" class="text-xs font-bold text-teal-500 bg-teal-50 w-16 px-2 py-1 rounded-full text-center">
                        <div class="flex space-x-2">
                            <button @click="openNav(item.location)" class="text-slate-400 hover:text-teal-500"><i data-lucide="navigation" class="w-4 h-4"></i></button>
                            <button @click="deleteItem(index)" class="text-slate-300 hover:text-red-400"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                        </div>
                    </div>
                    <input v-model="item.location" class="text-lg font-bold text-slate-800 mb-1" placeholder="地點名稱">
                    <textarea v-model="item.note" class="text-xs text-slate-500 leading-relaxed h-auto min-h-[40px]" placeholder="輸入備註或連結..." rows="2"></textarea>
                    
                    <button v-if="isLink(item.note)" @click="openLink(item.note)" class="mt-2 flex items-center text-[10px] bg-blue-50 text-blue-600 px-2 py-1 rounded border border-blue-100">
                        <i data-lucide="external-link" class="w-3 h-3 mr-1"></i> 開啟連結
                    </button>
                </div>
                <button @click="addItem" class="w-full py-4 border-2 border-dashed border-slate-300 rounded-3xl text-slate-400 flex items-center justify-center space-x-2 bg-white/30">
                    <i data-lucide="plus" class="w-5 h-5"></i>
                    <span class="font-bold">新增行程</span>
                </button>
            </div>

            <div v-if="activeTab === 'split'" class="space-y-4">
                <div class="glass-card p-6 rounded-3xl bg-teal-600 text-white shadow-lg">
                    <div class="grid grid-cols-2 gap-4 border-b border-teal-400/50 pb-4 mb-4">
                        <div><p class="text-teal-100 text-[10px] mb-1 uppercase font-bold">Total (JPY)</p><h3 class="text-2xl font-bold">¥ {{ totalExpenses.toLocaleString() }}</h3></div>
                        <div><p class="text-teal-100 text-[10px] mb-1 uppercase font-bold">Total (TWD)</p><h3 class="text-2xl font-bold">$ {{ Math.round(totalExpenses * exchangeRate).toLocaleString() }}</h3></div>
                    </div>
                    <div class="flex items-center justify-between text-sm">
                        <div class="flex items-center bg-teal-700/50 px-3 py-1 rounded-full"><span class="mr-2 text-xs">匯率:</span><input v-model.number="exchangeRate" type="number" step="0.001" class="w-16 bg-transparent text-white font-bold"></div>
                        <div class="flex items-center bg-teal-700/50 px-3 py-1 rounded-full"><span class="mr-2 text-xs">人數:</span><input v-model.number="peopleCount" type="number" class="w-8 bg-transparent text-white font-bold text-center"></div>
                    </div>
                </div>
                <div class="space-y-3">
                    <div v-for="(bill, idx) in expenses" :key="idx" class="flex items-center justify-between p-4 bg-white/80 rounded-2xl shadow-sm">
                        <div><p class="font-bold text-slate-700">{{ bill.title }}</p><p class="text-xs text-slate-400">¥ {{ bill.amount.toLocaleString() }} (約 ${{ Math.round(bill.amount * exchangeRate) }})</p></div>
                        <button @click="expenses.splice(idx, 1)" class="text-slate-300 hover:text-red-400"><i data-lucide="x-circle" class="w-5 h-5"></i></button>
                    </div>
                    <div class="p-5 glass-card rounded-2xl border-dashed border-2 border-slate-200">
                        <input v-model="newExpenseTitle" placeholder="支出品項" class="mb-2 p-2 text-sm border-b border-slate-100">
                        <input v-model.number="newExpenseAmount" type="number" placeholder="金額 (JPY)" class="mb-4 p-2 text-sm border-b border-slate-100">
                        <button @click="addExpense" class="w-full bg-slate-800 text-white py-3 rounded-xl font-bold text-sm">新增項目</button>
                    </div>
                </div>
            </div>

            <div v-if="activeTab === 'phrases'" class="space-y-4">
                <div v-for="(p, idx) in phrases" :key="idx" class="glass-card p-4 rounded-2xl shadow-sm border border-white/50">
                    <div class="flex justify-between items-start mb-1">
                        <input v-model="p.zh" class="font-bold text-slate-800 text-sm w-full" placeholder="中文對話">
                        <button @click="phrases.splice(idx, 1)" class="text-slate-300 ml-2"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                    </div>
                    <textarea v-model="p.jp" class="text-teal-600 font-medium text-[13px] w-full" rows="2" placeholder="日文翻譯"></textarea>
                </div>
                <button @click="phrases.push({zh: '新對話', jp: '新しい会話'})" class="w-full py-4 border-2 border-dashed border-slate-300 rounded-2xl text-slate-400 flex items-center justify-center space-x-2 bg-white/30">
                    <i data-lucide="plus" class="w-5 h-5"></i>
                    <span class="font-bold text-sm">新增自訂對話</span>
                </button>
            </div>
        </main>

        <nav class="fixed bottom-4 left-1/2 -translate-x-1/2 w-[90%] max-w-[360px] h-16 glass-card rounded-full flex items-center justify-around px-4 shadow-xl border border-white/50">
            <button @click="activeTab = 'itinerary'" :class="activeTab === 'itinerary' ? 'text-teal-600' : 'text-slate-300'"><i data-lucide="calendar"></i></button>
            <button @click="activeTab = 'split'" :class="activeTab === 'split' ? 'text-teal-600' : 'text-slate-300'"><i data-lucide="wallet"></i></button>
            <button @click="activeTab = 'phrases'" :class="activeTab === 'phrases' ? 'text-teal-600' : 'text-slate-300'"><i data-lucide="languages"></i></button>
        </nav>
    </div>

    <script>
        const { createApp, ref, onMounted, computed, watch } = Vue;

        createApp({
            setup() {
                const currentDay = ref(1);
                const activeTab = ref('itinerary');
                const weather = ref({ temp: 22, desc: '載入中' });
                const peopleCount = ref(2);
                const exchangeRate = ref(0.215);

                const dateInfo = [
                    { date: '1/4', week: '日' }, { date: '1/5', week: '一' },
                    { date: '1/6', week: '二' }, { date: '1/7', week: '三' }, { date: '1/8', week: '四' }
                ];

                // 根據您的需求更新的常用對話清單
                const defaultPhrases = [
                    { zh: "我要儲值", jp: "チャージをお願いします。\n(Cha-ji o onegaishimasu)" },
                    { zh: "不用袋子", jp: "袋はいりません。\n(Fukuro wa irimasen)" },
                    { zh: "這個多少錢？", jp: "これはいくらですか？\n(Kore wa ikura desu ka?)" },
                    { zh: "你有這個嗎？", jp: "これはありますか？\n(Kore wa arimasu ka?)" },
                    { zh: "這是什麼？", jp: "これは何ですか？\n(Kore wa nan desu ka?)" },
                    { zh: "我用現金支付", jp: "現金で払います。\n(Genkin de haraimasu)" },
                    { zh: "我用信用卡支付", jp: "クレジットカードで払います。\n(Kurejitto ka-do de haraimasu)" },
                    { zh: "請不要加蔥", jp: "ねぎを入れないでください。\n(Negi o irenaide kudasai)" },
                    { zh: "請給我一杯水", jp: "お水を一杯ください。\n(Omizu o ippai kudasai)" },
                    { zh: "請問廁所在哪裡？", jp: "お手洗いはどこですか？\n(Otearai wa doko desu ka?)" },
                    { zh: "不好意思我不會日文，請對著這個翻譯app說話", jp: "すみません、日本語ができません。この翻訳アプリに向かって話してください。\n(Sumimasen, nihongo ga dekimasen. Kono honyaku apuri ni mukatte hanashite kudasai)" }
                ];

                const defaultItinerary = {
                    1: [
                        { time: "09:45", location: "桃園機場", note: "12:25 抵達沖繩" },
                        { time: "14:00", location: "OTS取車", note: "租車手續" },
                        { time: "15:00", location: "系滿魚市場", note: "吃午餐\nMapCode: 232 484 077*14" },
                        { time: "17:30", location: "LCH飯店 (北部)", note: "入住＋海灘散步\nMapCode: 206 411 325*73" }
                    ],
                    2: [
                        { time: "09:00", location: "許田休息站", note: "MapCode: 206 476 705*46" },
                        { time: "10:10", location: "古宇利南端展望台", note: "MapCode: 485 601 892*07" },
                        { time: "11:10", location: "美麗海水族館", note: "含午餐+表演\nMapCode: 553 075 592*40" },
                        { time: "18:00", location: "燒肉本部牧場", note: "晚餐時間\nMapCode: 206 655 716*78" },
                        { time: "19:20", location: "名護逛街", note: "UNIQLO / 唐吉訶德" }
                    ],
                    3: [
                        { time: "09:10", location: "名護自然動植物園", note: "MapCode: 206 689 696*34" },
                        { time: "12:10", location: "萬座毛", note: "MapCode: 206 282 881*56" },
                        { time: "13:50", location: "美國村", note: "逛街、夕陽、晚餐\nMapCode: 33 525 442*36" },
                        { time: "18:40", location: "那霸拉根特飯店", note: "入住，可晃國際通\nMapCode: 33 157 750*54" }
                    ],
                    4: [
                        { time: "09:00", location: "泊港魚市場", note: "MapCode: 33 216 119*82" },
                        { time: "10:30", location: "國際通/牧志市場", note: "肉屋" },
                        { time: "12:30", location: "暖暮拉麵 系滿店", note: "MapCode: 232 515 598*75" },
                        { time: "14:00", location: "西松屋 豐崎店", note: "MapCode: 232 543 400*35" },
                        { time: "15:20", location: "豐崎海濱公園", note: "MapCode: 232 543 123*28" },
                        { time: "16:40", location: "瀨長島", note: "夕陽＋晚餐\nMapCode: 33 002 486*08" }
                    ],
                    5: [
                        { time: "09:00", location: "達磨寺", note: "MapCode: 33 161 568*51" },
                        { time: "11:30", location: "自由時間", note: "咖啡廳或最後補買" },
                        { time: "13:30", location: "還車", note: "搭接駁車去機場" },
                        { time: "16:55", location: "那霸機場", note: "起飛 ✈️" }
                    ]
                };

                const itinerary = ref(JSON.parse(localStorage.getItem('ok_itinerary_2026')) || defaultItinerary);
                const expenses = ref(JSON.parse(localStorage.getItem('ok_expenses_2026')) || []);
                const phrases = ref(JSON.parse(localStorage.getItem('ok_phrases_2026')) || defaultPhrases);

                watch([itinerary, expenses, phrases, exchangeRate, peopleCount], () => {
                    localStorage.setItem('ok_itinerary_2026', JSON.stringify(itinerary.value));
                    localStorage.setItem('ok_expenses_2026', JSON.stringify(expenses.value));
                    localStorage.setItem('ok_phrases_2026', JSON.stringify(phrases.value));
                }, { deep: true });

                const newExpenseTitle = ref('');
                const newExpenseAmount = ref(null);
                const totalExpenses = computed(() => expenses.value.reduce((sum, item) => sum + (item.amount || 0), 0));

                const addItem = () => { itinerary.value[currentDay.value].push({ time: "12:00", location: "新地點", note: "" }); setTimeout(() => lucide.createIcons(), 0); };
                const deleteItem = (idx) => { if(confirm("確定刪除？")) itinerary.value[currentDay.value].splice(idx, 1); };
                const openNav = (location) => { window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(location)}`, '_blank'); };
                const isLink = (text) => text && (text.includes('http://') || text.includes('https://'));
                const openLink = (text) => { const url = text.match(/(https?:\/\/[^\s]+)/g); if (url) window.open(url[0], '_blank'); };
                const addExpense = () => { if(newExpenseTitle.value && newExpenseAmount.value) { expenses.value.push({ title: newExpenseTitle.value, amount: newExpenseAmount.value }); newExpenseTitle.value = ''; newExpenseAmount.value = null; } };

                onMounted(() => {
                    lucide.createIcons();
                    fetch('https://api.open-meteo.com/v1/forecast?latitude=26.2124&longitude=127.6809&current_weather=true')
                        .then(r => r.json()).then(d => { weather.value = { temp: Math.round(d.current_weather.temperature), desc: '沖繩' }; }).catch(() => {});
                });

                watch([activeTab, currentDay], () => setTimeout(() => lucide.createIcons(), 0));

                return { currentDay, activeTab, itinerary, weather, dateInfo, expenses, newExpenseTitle, newExpenseAmount, totalExpenses, peopleCount, exchangeRate, phrases, addItem, deleteItem, openNav, addExpense, isLink, openLink };
            }
        }).mount('#app');
    </script>
</body>
</html>